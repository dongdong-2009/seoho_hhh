###############################################################################
#                                                                             #
# IAR C/C++ Compiler V5.30.0.50166/W32 for Atmel AVR    01/Aug/2011  13:59:27 #
# Copyright 1996-2009 IAR Systems AB.                                         #
#                                                                             #
#    Source file  =  D:\work\SEOHO_VD\SEOHO_HHH\KEYPAD335_110731_SEOHO_crc\so #
#                    urce\mcu\rs232_MMItoPANEL.c                              #
#    Command line =  D:\work\SEOHO_VD\SEOHO_HHH\KEYPAD335_110731_SEOHO_crc\so #
#                    urce\mcu\rs232_MMItoPANEL.c --cpu=m2560 -ms -o           #
#                    D:\work\SEOHO_VD\SEOHO_HHH\KEYPAD335_110731_SEOHO_crc\De #
#                    bug\Obj\ -lC D:\work\SEOHO_VD\SEOHO_HHH\KEYPAD335_110731 #
#                    _SEOHO_crc\Debug\List\ -lA D:\work\SEOHO_VD\SEOHO_HHH\KE #
#                    YPAD335_110731_SEOHO_crc\Debug\List\ -y                  #
#                    --initializers_in_flash -z3 --no_cse --no_inline         #
#                    --no_code_motion --no_cross_call --no_clustering         #
#                    --no_tbaa --debug --enable_external_bus                  #
#                    -DENABLE_BIT_DEFINITIONS -e --enable_multibytes -I       #
#                    "C:\Program Files\IAR Systems\Embedded Workbench         #
#                    5.3\avr\INC\" -I "C:\Program Files\IAR Systems\Embedded  #
#                    Workbench 5.3\avr\INC\CLIB\" --eeprom_size 4096          #
#    List file    =  D:\work\SEOHO_VD\SEOHO_HHH\KEYPAD335_110731_SEOHO_crc\De #
#                    bug\List\rs232_MMItoPANEL.lst                            #
#    Object file  =  D:\work\SEOHO_VD\SEOHO_HHH\KEYPAD335_110731_SEOHO_crc\De #
#                    bug\Obj\rs232_MMItoPANEL.r90                             #
#                                                                             #
#                                                                             #
###############################################################################

D:\work\SEOHO_VD\SEOHO_HHH\KEYPAD335_110731_SEOHO_crc\source\mcu\rs232_MMItoPANEL.c
      1          //==============================================================================================
      2          //
      3          // Copyright(C) 2008 HanYoung ELEC. Co., LTD.
      4          // Designed by Paul B.H Park(idonno2000)
      5          //
      6          //
      7          //	filename : serial.c
      8          //	description : 시리얼통신 함수 정의
      9          //
     10          //	history : 2008-05-09 4:03오후
     11          //            2008-06-26 - 링퍼버 수신모듈 구성
     12          //                       - 송신부분은 테스트중
     13          //                       - 관련문서 ( ringbuffer.doc )
     14          //                                  ( 링버퍼 패킷송수신.vsd) 
     15          //           2008-08-20 - printf함수 포함
     16          //                              - 링버퍼 수신모듈 리턴인자 수정 (0or1)
     17          //           1010-03-03 - MINV MMI to CTRL_PANEL간 통신 전용
     18          //                              - 기존의 링버퍼를 활용하여 자기자신의 데이터가 변할蒻?//===============================================================================================
     19          
     20          //#include <avr/io.h>
     21          //#include <avr/interrupt.h>
     22          //#include <util/delay.h>
     23          
     24          #include <inavr.h>
     25          #include <iom2560.h>

   \                                 In  segment ABSOLUTE, at 0xc6
   \   <__C115> volatile __io _A_UDR0
   \                     _A_UDR0:
   \   00000000                      DS8 1

   \                                 In  segment ABSOLUTE, at 0xc4
   \   <__C119> volatile __io _A_UBRR0
   \                     _A_UBRR0:
   \   00000000                      DS8 2

   \                                 In  segment ABSOLUTE, at 0xc2
   \   <__C123> volatile __io _A_UCSR0C
   \                     _A_UCSR0C:
   \   00000000                      DS8 1

   \                                 In  segment ABSOLUTE, at 0xc1
   \   <__C126> volatile __io _A_UCSR0B
   \                     _A_UCSR0B:
   \   00000000                      DS8 1

   \                                 In  segment ABSOLUTE, at 0xc0
   \   <__C129> volatile __io _A_UCSR0A
   \                     _A_UCSR0A:
   \   00000000                      DS8 1
     26          
     27          #include <string.h>
     28          #include "type.h"
     29          #include "util.h"
     30          #include "rs232_MMItoPANEL.h"
     31          
     32          #include "display.h"
     33          

   \                                 In  segment NEAR_Z, align 1, keep-with-next
   \   00000000                      REQUIRE `?<Segment init: NEAR_Z>`
     34          CRC_flg	CRC ;
   \                     CRC:
   \   00000000                      DS8 2

   \                                 In  segment NEAR_Z, align 1, keep-with-next
   \   00000000                      REQUIRE `?<Segment init: NEAR_Z>`
     35          Data_flg	data_flg;
   \                     data_flg:
   \   00000000                      DS8 2
     36          

   \                                 In  segment NEAR_I, align 1, keep-with-next
   \   00000000                      REQUIRE `?<Segment init: NEAR_I>`
     37          unsigned int Communication_Fault_Cnt = 3;
   \                     Communication_Fault_Cnt:
   \   00000000                      DS8 2
   \   00000002                      REQUIRE `?<Initializer for Communication_Fault_Cnt>`

   \                                 In  segment NEAR_Z, align 1, keep-with-next
   \   00000000                      REQUIRE `?<Segment init: NEAR_Z>`
     38          unsigned char Communication_Fault_Flag = 0;
   \                     Communication_Fault_Flag:
   \   00000000                      DS8 1
     39          
     40          

   \                                 In  segment NEAR_Z, align 1, keep-with-next
   \   00000000                      REQUIRE `?<Segment init: NEAR_Z>`
     41          unsigned int SCI_Registers[BUF_MAX];
   \                     SCI_Registers:
   \   00000000                      DS8 6800
     42          

   \                                 In  segment NEAR_Z, align 1, keep-with-next
   \   00000000                      REQUIRE `?<Segment init: NEAR_Z>`
     43          unsigned char packet[8];
   \                     packet:
   \   00000000                      DS8 8
     44          

   \                                 In  segment NEAR_I, align 1, keep-with-next
   \   00000000                      REQUIRE `?<Segment init: NEAR_I>`
     45          static const UCHAR aucCRCHi[] = {
   \                     aucCRCHi:
   \   00000000                      DS8 256
   \   00000100                      REQUIRE `?<Initializer for aucCRCHi>`
     46              0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 0x01, 0xC0, 0x80, 0x41,
     47              0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 0x00, 0xC1, 0x81, 0x40,
     48              0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 0x01, 0xC0, 0x80, 0x41,
     49              0x00, 0xC1, 0x81, 0x40, 0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41,
     50              0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 0x01, 0xC0, 0x80, 0x41,
     51              0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 0x00, 0xC1, 0x81, 0x40,
     52              0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 0x00, 0xC1, 0x81, 0x40,
     53              0x01, 0xC0, 0x80, 0x41, 0x01, 0xC0, 0x80, 0x41, 0x00, 0xC1, 0x81, 0x40,
     54              0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 0x01, 0xC0, 0x80, 0x41,
     55              0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 0x00, 0xC1, 0x81, 0x40,
     56              0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 0x01, 0xC0, 0x80, 0x41,
     57              0x00, 0xC1, 0x81, 0x40, 0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 
     58              0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 0x01, 0xC0, 0x80, 0x41,
     59              0x00, 0xC1, 0x81, 0x40, 0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 
     60              0x01, 0xC0, 0x80, 0x41, 0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41,
     61              0x00, 0xC1, 0x81, 0x40, 0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41,
     62              0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 0x01, 0xC0, 0x80, 0x41, 
     63              0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 0x00, 0xC1, 0x81, 0x40,
     64              0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 0x01, 0xC0, 0x80, 0x41,
     65              0x00, 0xC1, 0x81, 0x40, 0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41,
     66              0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 0x01, 0xC0, 0x80, 0x41,
     67              0x00, 0xC1, 0x81, 0x40
     68          };
     69          

   \                                 In  segment NEAR_I, align 1, keep-with-next
   \   00000000                      REQUIRE `?<Segment init: NEAR_I>`
     70          static const UCHAR aucCRCLo[] = {
   \                     aucCRCLo:
   \   00000000                      DS8 256
   \   00000100                      REQUIRE `?<Initializer for aucCRCLo>`
     71              0x00, 0xC0, 0xC1, 0x01, 0xC3, 0x03, 0x02, 0xC2, 0xC6, 0x06, 0x07, 0xC7,
     72              0x05, 0xC5, 0xC4, 0x04, 0xCC, 0x0C, 0x0D, 0xCD, 0x0F, 0xCF, 0xCE, 0x0E,
     73              0x0A, 0xCA, 0xCB, 0x0B, 0xC9, 0x09, 0x08, 0xC8, 0xD8, 0x18, 0x19, 0xD9,
     74              0x1B, 0xDB, 0xDA, 0x1A, 0x1E, 0xDE, 0xDF, 0x1F, 0xDD, 0x1D, 0x1C, 0xDC,
     75              0x14, 0xD4, 0xD5, 0x15, 0xD7, 0x17, 0x16, 0xD6, 0xD2, 0x12, 0x13, 0xD3,
     76              0x11, 0xD1, 0xD0, 0x10, 0xF0, 0x30, 0x31, 0xF1, 0x33, 0xF3, 0xF2, 0x32,
     77              0x36, 0xF6, 0xF7, 0x37, 0xF5, 0x35, 0x34, 0xF4, 0x3C, 0xFC, 0xFD, 0x3D,
     78              0xFF, 0x3F, 0x3E, 0xFE, 0xFA, 0x3A, 0x3B, 0xFB, 0x39, 0xF9, 0xF8, 0x38, 
     79              0x28, 0xE8, 0xE9, 0x29, 0xEB, 0x2B, 0x2A, 0xEA, 0xEE, 0x2E, 0x2F, 0xEF,
     80              0x2D, 0xED, 0xEC, 0x2C, 0xE4, 0x24, 0x25, 0xE5, 0x27, 0xE7, 0xE6, 0x26,
     81              0x22, 0xE2, 0xE3, 0x23, 0xE1, 0x21, 0x20, 0xE0, 0xA0, 0x60, 0x61, 0xA1,
     82              0x63, 0xA3, 0xA2, 0x62, 0x66, 0xA6, 0xA7, 0x67, 0xA5, 0x65, 0x64, 0xA4,
     83              0x6C, 0xAC, 0xAD, 0x6D, 0xAF, 0x6F, 0x6E, 0xAE, 0xAA, 0x6A, 0x6B, 0xAB, 
     84              0x69, 0xA9, 0xA8, 0x68, 0x78, 0xB8, 0xB9, 0x79, 0xBB, 0x7B, 0x7A, 0xBA,
     85              0xBE, 0x7E, 0x7F, 0xBF, 0x7D, 0xBD, 0xBC, 0x7C, 0xB4, 0x74, 0x75, 0xB5,
     86              0x77, 0xB7, 0xB6, 0x76, 0x72, 0xB2, 0xB3, 0x73, 0xB1, 0x71, 0x70, 0xB0,
     87              0x50, 0x90, 0x91, 0x51, 0x93, 0x53, 0x52, 0x92, 0x96, 0x56, 0x57, 0x97,
     88              0x55, 0x95, 0x94, 0x54, 0x9C, 0x5C, 0x5D, 0x9D, 0x5F, 0x9F, 0x9E, 0x5E,
     89              0x5A, 0x9A, 0x9B, 0x5B, 0x99, 0x59, 0x58, 0x98, 0x88, 0x48, 0x49, 0x89,
     90              0x4B, 0x8B, 0x8A, 0x4A, 0x4E, 0x8E, 0x8F, 0x4F, 0x8D, 0x4D, 0x4C, 0x8C,
     91              0x44, 0x84, 0x85, 0x45, 0x87, 0x47, 0x46, 0x86, 0x82, 0x42, 0x43, 0x83,
     92              0x41, 0x81, 0x80, 0x40
     93          };
     94          
     95          

   \                                 In  segment FARCODE, align 2, keep-with-next
     96          unsigned int CRC16( UCHAR * pucFrame,unsigned int usLen )
   \                     CRC16:
     97          {
   \   00000000   2F59               MOV     R21, R25
   \   00000002   2E28               MOV     R2, R24
   \   00000004                      REQUIRE __RSTACK_in_external_ram_new_way
   \   00000004   01C8               MOVW    R25:R24, R17:R16
     98              UCHAR           ucCRCHi = 0xFF;
   \   00000006   EF4F               LDI     R20, 255
     99              UCHAR           ucCRCLo = 0xFF;
   \   00000008   EF6F               LDI     R22, 255
   \   0000000A   C012               RJMP    ??CRC16_0
    100              int             iIndex;
    101          
    102              while( usLen-- )
    103              {
    104                  iIndex = ucCRCLo ^ *( pucFrame++ );
   \                     ??CRC16_1:
   \   0000000C   2E06               MOV     R0, R22
   \   0000000E   2411               CLR     R1
   \   00000010   01FC               MOVW    R31:R30, R25:R24
   \   00000012   8100               LD      R16, Z
   \   00000014   E010               LDI     R17, 0
   \   00000016   2600               EOR     R0, R16
   \   00000018   2611               EOR     R1, R17
   \   0000001A   9601               ADIW    R25:R24, 1
    105                  ucCRCLo = ( UCHAR )( ucCRCHi ^ aucCRCHi[iIndex] );
   \   0000001C   01F0               MOVW    R31:R30, R1:R0
   \   0000001E   ....               SUBI    R30, LOW((-(aucCRCHi) & 0xFFFF))
   \   00000020   ....               SBCI    R31, (-(aucCRCHi) & 0xFFFF) >> 8
   \   00000022   8100               LD      R16, Z
   \   00000024   2740               EOR     R20, R16
   \   00000026   2F64               MOV     R22, R20
    106                  ucCRCHi = aucCRCLo[iIndex];
   \   00000028   01F0               MOVW    R31:R30, R1:R0
   \   0000002A   ....               SUBI    R30, LOW((-(aucCRCLo) & 0xFFFF))
   \   0000002C   ....               SBCI    R31, (-(aucCRCLo) & 0xFFFF) >> 8
   \   0000002E   8140               LD      R20, Z
    107              }
   \                     ??CRC16_0:
   \   00000030   0189               MOVW    R17:R16, R19:R18
   \   00000032   0198               MOVW    R19:R18, R17:R16
   \   00000034   5021               SUBI    R18, 1
   \   00000036   4030               SBCI    R19, 0
   \   00000038   2B01               OR      R16, R17
   \   0000003A   F741               BRNE    ??CRC16_1
    108              return ( unsigned int )( ucCRCHi << 8 | ucCRCLo );
   \   0000003C   2F14               MOV     R17, R20
   \   0000003E   E000               LDI     R16, 0
   \   00000040   E070               LDI     R23, 0
   \   00000042   2B06               OR      R16, R22
   \   00000044   2B17               OR      R17, R23
   \   00000046   2D82               MOV     R24, R2
   \   00000048   2F95               MOV     R25, R21
   \   0000004A   9508               RET
    109          }
    110          
    111          
    112          
    113          //==============================================================
    114          // UART  initialize

   \                                 In  segment FARCODE, align 2, keep-with-next
    115          void UART_init(void)
   \                     UART_init:
    116          {
   \   00000000                      REQUIRE __RSTACK_in_external_ram_new_way
    117          	UBRR0H = 0; 								// 19200 baud for 16MHz OSC
   \   00000000   E000               LDI     R16, 0
   \   00000002   930000C5           STS     197, R16
    118          	UBRR0L = 51;
   \   00000006   E303               LDI     R16, 51
   \   00000008   9300....           STS     _A_UBRR0, R16
    119          	UCSR0A = 0x00;								// asynchronous normal mode
   \   0000000C   E000               LDI     R16, 0
   \   0000000E   9300....           STS     _A_UCSR0A, R16
    120          	UCSR0B = 0xD8;								// Rx/Tx enbale, Rx Complete interrupt enable
   \   00000012   ED08               LDI     R16, 216
   \   00000014   9300....           STS     _A_UCSR0B, R16
    121          	UCSR0C = 0x06;								// 8 data, 1 stop, no parity
   \   00000018   E006               LDI     R16, 6
   \   0000001A   9300....           STS     _A_UCSR0C, R16
    122          
    123          #if 0
    124          	//timer 3 인터럽트
    125          	TCCR3A = 0x10;
    126          	TCCR3B = 0x0C;
    127          	TCCR3C = 0x00;
    128          	OCR3A = 62;//1ms
    129          	TCNT3 = 0x0000;
    130          
    131          	TIMSK3 = 0x02;
    132          	TIFR3 = 0x2F;
    133          #endif
    134          
    135          
    136          	CRC.Word = 0 ;
   \   0000001E   E000               LDI     R16, 0
   \   00000020   E010               LDI     R17, 0
   \   00000022   9300....           STS     CRC, R16
   \   00000026   9310....           STS     (CRC + 1), R17
    137          
    138          }
   \   0000002A   9508               RET
   \   0000002C                      REQUIRE _A_UBRR0
   \   0000002C                      REQUIRE _A_UCSR0C
   \   0000002C                      REQUIRE _A_UCSR0B
   \   0000002C                      REQUIRE _A_UCSR0A
    139          
    140          

   \                                 In  segment FARCODE, align 2, keep-with-next
    141          void WriteDataMem(unsigned int addr, unsigned int dat)
   \                     WriteDataMem:
    142          {
   \   00000000                      REQUIRE __RSTACK_in_external_ram_new_way
    143          	//*(volatile int *)(DATA_REG + (addr<<1)+0) = (char)(dat>>8);
    144          	//*(volatile int *)(DATA_REG + (addr<<1)+1) = (char)dat;
    145          	DATA_Registers[addr] = dat;
   \   00000000   0F00               LSL     R16
   \   00000002   1F11               ROL     R17
   \   00000004   01F8               MOVW    R31:R30, R17:R16
   \   00000006   ....               SUBI    R30, LOW((-(DATA_Registers) & 0xFFFF))
   \   00000008   ....               SBCI    R31, (-(DATA_Registers) & 0xFFFF) >> 8
   \   0000000A   8320               ST      Z, R18
   \   0000000C   8331               STD     Z+1, R19
    146          }
   \   0000000E   9508               RET

   \                                 In  segment FARCODE, align 2, keep-with-next
    147          unsigned int ReadDataMem(unsigned int addr)
   \                     ReadDataMem:
    148          {
   \   00000000                      REQUIRE __RSTACK_in_external_ram_new_way
    149          	unsigned int data_word = 0;
   \   00000000   E020               LDI     R18, 0
   \   00000002   E030               LDI     R19, 0
    150          	//data_word =  MAKEWORD( (*(volatile int *)(DATA_REG + (addr<<1)+0 )),(*(volatile int *)(DATA_REG + (addr<<1)+1)) );
    151          	data_word = DATA_Registers[addr];
   \   00000004   0F00               LSL     R16
   \   00000006   1F11               ROL     R17
   \   00000008   01F8               MOVW    R31:R30, R17:R16
   \   0000000A   ....               SUBI    R30, LOW((-(DATA_Registers) & 0xFFFF))
   \   0000000C   ....               SBCI    R31, (-(DATA_Registers) & 0xFFFF) >> 8
   \   0000000E   8100               LD      R16, Z
   \   00000010   8111               LDD     R17, Z+1
   \   00000012   0198               MOVW    R19:R18, R17:R16
    152           	return data_word;
   \   00000014   0189               MOVW    R17:R16, R19:R18
   \   00000016   9508               RET
    153          }
    154          //-----------------------------
    155          // 데이타 수신
    156          //-----------------------------

   \                                 In  segment NEAR_Z, align 1, keep-with-next
   \   00000000                      REQUIRE `?<Segment init: NEAR_Z>`
    157           unsigned char SciC_RxStep=0;
   \                     SciC_RxStep:
   \   00000000                      DS8 1

   \                                 In  segment NEAR_Z, align 1, keep-with-next
   \   00000000                      REQUIRE `?<Segment init: NEAR_Z>`
    158           unsigned char SciC_RxFlag=0;
   \                     SciC_RxFlag:
   \   00000000                      DS8 1
    159          

   \                                 In  segment NEAR_Z, align 1, keep-with-next
   \   00000000                      REQUIRE `?<Segment init: NEAR_Z>`
    160           unsigned int RxType=0;
   \                     RxType:
   \   00000000                      DS8 2

   \                                 In  segment NEAR_Z, align 1, keep-with-next
   \   00000000                      REQUIRE `?<Segment init: NEAR_Z>`
    161           unsigned int RxAddr=0;
   \                     RxAddr:
   \   00000000                      DS8 2

   \                                 In  segment NEAR_Z, align 1, keep-with-next
   \   00000000                      REQUIRE `?<Segment init: NEAR_Z>`
    162           unsigned int RxData=0;
   \                     RxData:
   \   00000000                      DS8 2

   \                                 In  segment NEAR_Z, align 1, keep-with-next
   \   00000000                      REQUIRE `?<Segment init: NEAR_Z>`
    163           unsigned int RxCRC=0;
   \                     RxCRC:
   \   00000000                      DS8 2

   \                                 In  segment NEAR_Z, align 1, keep-with-next
   \   00000000                      REQUIRE `?<Segment init: NEAR_Z>`
    164           unsigned char RxBuf[9];
   \                     RxBuf:
   \   00000000                      DS8 9

   \                                 In  segment NEAR_Z, align 1, keep-with-next
   \   00000000                      REQUIRE `?<Segment init: NEAR_Z>`
    165           unsigned char RXD0;
   \                     RXD0:
   \   00000000                      DS8 1
    166          
    167          #pragma vector = USART0_RX_vect

   \                                 In  segment FARCODE, align 2, keep-with-next
    168          __interrupt void USART0_RX_ISR(void)
   \                     USART0_RX_ISR:
    169          //ISR(USART0_RX_vect)	
    170          {
   \   00000000   924A               ST      -Y, R4
   \   00000002   93BA               ST      -Y, R27
   \   00000004   93AA               ST      -Y, R26
   \   00000006   939A               ST      -Y, R25
   \   00000008   938A               ST      -Y, R24
   \   0000000A   93FA               ST      -Y, R31
   \   0000000C   93EA               ST      -Y, R30
   \   0000000E   923A               ST      -Y, R3
   \   00000010   922A               ST      -Y, R2
   \   00000012   921A               ST      -Y, R1
   \   00000014   920A               ST      -Y, R0
   \   00000016   937A               ST      -Y, R23
   \   00000018   936A               ST      -Y, R22
   \   0000001A   935A               ST      -Y, R21
   \   0000001C   934A               ST      -Y, R20
   \   0000001E   933A               ST      -Y, R19
   \   00000020   932A               ST      -Y, R18
   \   00000022   931A               ST      -Y, R17
   \   00000024   930A               ST      -Y, R16
   \   00000026   B7AF               IN      R26, 0x3F
   \   00000028   B7BB               IN      R27, 0x3B
   \   0000002A   B64C               IN      R4, 0x3C
   \   0000002C                      REQUIRE ?Register_R4_is_cg_reg
   \   0000002C                      REQUIRE __RSTACK_in_external_ram_new_way
    171          char c;
    172          
    173          	RXD0 = UDR0 ;
   \   0000002C   9100....           LDS     R16, _A_UDR0
   \   00000030   9300....           STS     RXD0, R16
    174          	if(!SciC_RxFlag)
   \   00000034   9100....           LDS     R16, SciC_RxFlag
   \   00000038   2300               TST     R16
   \   0000003A   F009               BREQ    $+2+2
   \   0000003C   C16C               RJMP    ??USART0_RX_ISR_0
    175          	{
    176          		if(SciC_RxStep == 0)//sync1
   \   0000003E   9100....           LDS     R16, SciC_RxStep
   \   00000042   2300               TST     R16
   \   00000044   F489               BRNE    ??USART0_RX_ISR_1
    177          		{
    178          			if(RXD0 == 0xAB)
   \   00000046   9100....           LDS     R16, RXD0
   \   0000004A   3A0B               CPI     R16, 171
   \   0000004C   F449               BRNE    ??USART0_RX_ISR_2
    179          			{
    180          				
    181          				RxBuf[0] = 0xAB;
   \   0000004E   EA0B               LDI     R16, 171
   \   00000050   9300....           STS     RxBuf, R16
    182          				SciC_RxStep++;
   \   00000054   9100....           LDS     R16, SciC_RxStep
   \   00000058   9503               INC     R16
   \   0000005A   9300....           STS     SciC_RxStep, R16
   \   0000005E   C15E               RJMP    ??USART0_RX_ISR_3
    183          			}
    184          			else SciC_RxStep=0;
   \                     ??USART0_RX_ISR_2:
   \   00000060   E000               LDI     R16, 0
   \   00000062   9300....           STS     SciC_RxStep, R16
   \   00000066   C15A               RJMP    ??USART0_RX_ISR_3
    185          		}
    186          		else if(SciC_RxStep == 1)//sync2
   \                     ??USART0_RX_ISR_1:
   \   00000068   9100....           LDS     R16, SciC_RxStep
   \   0000006C   3001               CPI     R16, 1
   \   0000006E   F489               BRNE    ??USART0_RX_ISR_4
    187          		{
    188          			if(RXD0 == 0xCD)
   \   00000070   9100....           LDS     R16, RXD0
   \   00000074   3C0D               CPI     R16, 205
   \   00000076   F449               BRNE    ??USART0_RX_ISR_5
    189          			{
    190          				RxBuf[1] = 0xCD;
   \   00000078   EC0D               LDI     R16, 205
   \   0000007A   9300....           STS     (RxBuf + 1), R16
    191          				SciC_RxStep++;
   \   0000007E   9100....           LDS     R16, SciC_RxStep
   \   00000082   9503               INC     R16
   \   00000084   9300....           STS     SciC_RxStep, R16
   \   00000088   C149               RJMP    ??USART0_RX_ISR_3
    192          			}
    193          			else SciC_RxStep=0;
   \                     ??USART0_RX_ISR_5:
   \   0000008A   E000               LDI     R16, 0
   \   0000008C   9300....           STS     SciC_RxStep, R16
   \   00000090   C145               RJMP    ??USART0_RX_ISR_3
    194          		}
    195          		else if(SciC_RxStep == 2)//type
   \                     ??USART0_RX_ISR_4:
   \   00000092   9100....           LDS     R16, SciC_RxStep
   \   00000096   3002               CPI     R16, 2
   \   00000098   F451               BRNE    ??USART0_RX_ISR_6
    196          		{
    197          			RxBuf[2] = RXD0;
   \   0000009A   9100....           LDS     R16, RXD0
   \   0000009E   9300....           STS     (RxBuf + 2), R16
    198          			SciC_RxStep++;
   \   000000A2   9100....           LDS     R16, SciC_RxStep
   \   000000A6   9503               INC     R16
   \   000000A8   9300....           STS     SciC_RxStep, R16
   \   000000AC   C137               RJMP    ??USART0_RX_ISR_3
    199          		}
    200          		else if(SciC_RxStep == 3)//addr_h
   \                     ??USART0_RX_ISR_6:
   \   000000AE   9100....           LDS     R16, SciC_RxStep
   \   000000B2   3003               CPI     R16, 3
   \   000000B4   F451               BRNE    ??USART0_RX_ISR_7
    201          		{
    202          			RxBuf[3] = RXD0;
   \   000000B6   9100....           LDS     R16, RXD0
   \   000000BA   9300....           STS     (RxBuf + 3), R16
    203          			SciC_RxStep++;
   \   000000BE   9100....           LDS     R16, SciC_RxStep
   \   000000C2   9503               INC     R16
   \   000000C4   9300....           STS     SciC_RxStep, R16
   \   000000C8   C129               RJMP    ??USART0_RX_ISR_3
    204          		}
    205          		else if(SciC_RxStep == 4)//addr_l
   \                     ??USART0_RX_ISR_7:
   \   000000CA   9100....           LDS     R16, SciC_RxStep
   \   000000CE   3004               CPI     R16, 4
   \   000000D0   F451               BRNE    ??USART0_RX_ISR_8
    206          		{
    207          			RxBuf[4] = RXD0;
   \   000000D2   9100....           LDS     R16, RXD0
   \   000000D6   9300....           STS     (RxBuf + 4), R16
    208          			SciC_RxStep++;
   \   000000DA   9100....           LDS     R16, SciC_RxStep
   \   000000DE   9503               INC     R16
   \   000000E0   9300....           STS     SciC_RxStep, R16
   \   000000E4   C11B               RJMP    ??USART0_RX_ISR_3
    209          		}
    210          		else if(SciC_RxStep == 5)//data_h
   \                     ??USART0_RX_ISR_8:
   \   000000E6   9100....           LDS     R16, SciC_RxStep
   \   000000EA   3005               CPI     R16, 5
   \   000000EC   F451               BRNE    ??USART0_RX_ISR_9
    211          		{
    212          			RxBuf[5] = RXD0;
   \   000000EE   9100....           LDS     R16, RXD0
   \   000000F2   9300....           STS     (RxBuf + 5), R16
    213          			SciC_RxStep++;
   \   000000F6   9100....           LDS     R16, SciC_RxStep
   \   000000FA   9503               INC     R16
   \   000000FC   9300....           STS     SciC_RxStep, R16
   \   00000100   C10D               RJMP    ??USART0_RX_ISR_3
    214          		}
    215          		else if(SciC_RxStep == 6)//data_l
   \                     ??USART0_RX_ISR_9:
   \   00000102   9100....           LDS     R16, SciC_RxStep
   \   00000106   3006               CPI     R16, 6
   \   00000108   F451               BRNE    ??USART0_RX_ISR_10
    216          		{
    217          			RxBuf[6] = RXD0;
   \   0000010A   9100....           LDS     R16, RXD0
   \   0000010E   9300....           STS     (RxBuf + 6), R16
    218          			SciC_RxStep++;
   \   00000112   9100....           LDS     R16, SciC_RxStep
   \   00000116   9503               INC     R16
   \   00000118   9300....           STS     SciC_RxStep, R16
   \   0000011C   C0FF               RJMP    ??USART0_RX_ISR_3
    219          		}
    220          		else if(SciC_RxStep == 7)//crc_H
   \                     ??USART0_RX_ISR_10:
   \   0000011E   9100....           LDS     R16, SciC_RxStep
   \   00000122   3007               CPI     R16, 7
   \   00000124   F451               BRNE    ??USART0_RX_ISR_11
    221          		{
    222          			RxBuf[7] = RXD0;
   \   00000126   9100....           LDS     R16, RXD0
   \   0000012A   9300....           STS     (RxBuf + 7), R16
    223          			SciC_RxStep++;
   \   0000012E   9100....           LDS     R16, SciC_RxStep
   \   00000132   9503               INC     R16
   \   00000134   9300....           STS     SciC_RxStep, R16
   \   00000138   C0F1               RJMP    ??USART0_RX_ISR_3
    224          		}
    225          		else//crc_L
    226          		{
    227          			RxBuf[8] = RXD0;
   \                     ??USART0_RX_ISR_11:
   \   0000013A   9100....           LDS     R16, RXD0
   \   0000013E   9300....           STS     (RxBuf + 8), R16
    228          
    229          			//CRC.Word = 0;
    230          			//CRC_16(RxBuf[0]);
    231          			//CRC_16(RxBuf[1]);
    232          			//CRC_16(RxBuf[2]);
    233          			//CRC_16(RxBuf[3]);
    234          			//CRC_16(RxBuf[4]);
    235          			//CRC_16(RxBuf[5]);
    236          			//CRC_16(RxBuf[6]);
    237          
    238          			CRC.Word = CRC16(RxBuf,7);
   \   00000142   E027               LDI     R18, 7
   \   00000144   E030               LDI     R19, 0
   \   00000146   ....               LDI     R16, LOW(RxBuf)
   \   00000148   ....               LDI     R17, (RxBuf) >> 8
   \   0000014A   ....               RCALL   CRC16
   \   0000014C   9300....           STS     CRC, R16
   \   00000150   9310....           STS     (CRC + 1), R17
    239          
    240          			RxType = RxBuf[2];
   \   00000154   9100....           LDS     R16, (RxBuf + 2)
   \   00000158   E010               LDI     R17, 0
   \   0000015A   9300....           STS     RxType, R16
   \   0000015E   9310....           STS     (RxType + 1), R17
    241          			RxAddr = ((unsigned int)RxBuf[3]<<8) | RxBuf[4] ;
   \   00000162   9130....           LDS     R19, (RxBuf + 3)
   \   00000166   E020               LDI     R18, 0
   \   00000168   9100....           LDS     R16, (RxBuf + 4)
   \   0000016C   E010               LDI     R17, 0
   \   0000016E   2B20               OR      R18, R16
   \   00000170   2B31               OR      R19, R17
   \   00000172   9320....           STS     RxAddr, R18
   \   00000176   9330....           STS     (RxAddr + 1), R19
    242          			RxData = ((unsigned int)RxBuf[5]<<8) | RxBuf[6] ;
   \   0000017A   9130....           LDS     R19, (RxBuf + 5)
   \   0000017E   E020               LDI     R18, 0
   \   00000180   9100....           LDS     R16, (RxBuf + 6)
   \   00000184   E010               LDI     R17, 0
   \   00000186   2B20               OR      R18, R16
   \   00000188   2B31               OR      R19, R17
   \   0000018A   9320....           STS     RxData, R18
   \   0000018E   9330....           STS     (RxData + 1), R19
    243          			RxCRC   = ((unsigned int)RxBuf[7]<<8) | RxBuf[8] ;
   \   00000192   9130....           LDS     R19, (RxBuf + 7)
   \   00000196   E020               LDI     R18, 0
   \   00000198   9100....           LDS     R16, (RxBuf + 8)
   \   0000019C   E010               LDI     R17, 0
   \   0000019E   2B20               OR      R18, R16
   \   000001A0   2B31               OR      R19, R17
   \   000001A2   9320....           STS     RxCRC, R18
   \   000001A6   9330....           STS     (RxCRC + 1), R19
    244          
    245          			if((RxBuf[7] == CRC.Byte.b1) && (RxBuf[8] == CRC.Byte.b0))
   \   000001AA   9100....           LDS     R16, (RxBuf + 7)
   \   000001AE   9110....           LDS     R17, (CRC + 1)
   \   000001B2   1701               CP      R16, R17
   \   000001B4   F009               BREQ    $+2+2
   \   000001B6   C0AB               RJMP    ??USART0_RX_ISR_12
   \   000001B8   9100....           LDS     R16, (RxBuf + 8)
   \   000001BC   9110....           LDS     R17, CRC
   \   000001C0   1701               CP      R16, R17
   \   000001C2   F009               BREQ    $+2+2
   \   000001C4   C0A4               RJMP    ??USART0_RX_ISR_12
    246          			{
    247          				SciC_RxFlag=1;
   \   000001C6   E001               LDI     R16, 1
   \   000001C8   9300....           STS     SciC_RxFlag, R16
    248          				SCI_Registers[RxAddr] = RxData;
   \   000001CC   9120....           LDS     R18, RxData
   \   000001D0   9130....           LDS     R19, (RxData + 1)
   \   000001D4   9100....           LDS     R16, RxAddr
   \   000001D8   9110....           LDS     R17, (RxAddr + 1)
   \   000001DC   0F00               LSL     R16
   \   000001DE   1F11               ROL     R17
   \   000001E0   01F8               MOVW    R31:R30, R17:R16
   \   000001E2   ....               SUBI    R30, LOW((-(SCI_Registers) & 0xFFFF))
   \   000001E4   ....               SBCI    R31, (-(SCI_Registers) & 0xFFFF) >> 8
   \   000001E6   8320               ST      Z, R18
   \   000001E8   8331               STD     Z+1, R19
    249          
    250          				if(RxType == SEND)
   \   000001EA   9100....           LDS     R16, RxType
   \   000001EE   9110....           LDS     R17, (RxType + 1)
   \   000001F2   3002               CPI     R16, 2
   \   000001F4   E020               LDI     R18, 0
   \   000001F6   0712               CPC     R17, R18
   \   000001F8   F599               BRNE    ??USART0_RX_ISR_13
    251          				{
    252          					CRC.Word = 0;
   \   000001FA   E000               LDI     R16, 0
   \   000001FC   E010               LDI     R17, 0
   \   000001FE   9300....           STS     CRC, R16
   \   00000202   9310....           STS     (CRC + 1), R17
    253          
    254          					RxBuf[2] = RESPONSE;
   \   00000206   E003               LDI     R16, 3
   \   00000208   9300....           STS     (RxBuf + 2), R16
    255          
    256          					CRC.Word = CRC16(RxBuf,7);
   \   0000020C   E027               LDI     R18, 7
   \   0000020E   E030               LDI     R19, 0
   \   00000210   ....               LDI     R16, LOW(RxBuf)
   \   00000212   ....               LDI     R17, (RxBuf) >> 8
   \   00000214   ....               RCALL   CRC16
   \   00000216   9300....           STS     CRC, R16
   \   0000021A   9310....           STS     (CRC + 1), R17
    257          
    258          					for(c=0;c<7;c++)
   \   0000021E   E080               LDI     R24, 0
   \   00000220   C007               RJMP    ??USART0_RX_ISR_14
    259          					{
    260          						TX0_char(RxBuf[c]);
   \                     ??USART0_RX_ISR_15:
   \   00000222   E090               LDI     R25, 0
   \   00000224   01FC               MOVW    R31:R30, R25:R24
   \   00000226   ....               SUBI    R30, LOW((-(RxBuf) & 0xFFFF))
   \   00000228   ....               SBCI    R31, (-(RxBuf) & 0xFFFF) >> 8
   \   0000022A   8100               LD      R16, Z
   \   0000022C   ....               RCALL   TX0_char
    261          					
    262          					}
   \   0000022E   9583               INC     R24
   \                     ??USART0_RX_ISR_14:
   \   00000230   3087               CPI     R24, 7
   \   00000232   F3B8               BRCS    ??USART0_RX_ISR_15
    263          					
    264          					//TX0_char(RxBuf[0]);		CRC_16(RxBuf[0]);
    265          					//TX0_char(RxBuf[1]);		CRC_16(RxBuf[1]);
    266          					//TX0_char(RESPONSE);		CRC_16(RESPONSE);
    267          					//TX0_char(RxBuf[3]);		CRC_16(RxBuf[3]);
    268          					//TX0_char(RxBuf[4]);		CRC_16(RxBuf[4]);
    269          					//TX0_char(RxBuf[5]);		CRC_16(RxBuf[5]);
    270          					//TX0_char(RxBuf[6]);		CRC_16(RxBuf[6]);
    271          					TX0_char(CRC.Byte.b1);
   \   00000234   9100....           LDS     R16, (CRC + 1)
   \   00000238   ....               RCALL   TX0_char
    272          					TX0_char(CRC.Byte.b0);
   \   0000023A   9100....           LDS     R16, CRC
   \   0000023E   ....               RCALL   TX0_char
    273          
    274          					DATA_Registers[RxAddr] = RxData;
   \   00000240   9120....           LDS     R18, RxData
   \   00000244   9130....           LDS     R19, (RxData + 1)
   \   00000248   9100....           LDS     R16, RxAddr
   \   0000024C   9110....           LDS     R17, (RxAddr + 1)
   \   00000250   0F00               LSL     R16
   \   00000252   1F11               ROL     R17
   \   00000254   01F8               MOVW    R31:R30, R17:R16
   \   00000256   ....               SUBI    R30, LOW((-(DATA_Registers) & 0xFFFF))
   \   00000258   ....               SBCI    R31, (-(DATA_Registers) & 0xFFFF) >> 8
   \   0000025A   8320               ST      Z, R18
   \   0000025C   8331               STD     Z+1, R19
   \   0000025E   C057               RJMP    ??USART0_RX_ISR_12
    275          				}
    276          				else if(RxType == REQUEST)
   \                     ??USART0_RX_ISR_13:
   \   00000260   9100....           LDS     R16, RxType
   \   00000264   9110....           LDS     R17, (RxType + 1)
   \   00000268   3004               CPI     R16, 4
   \   0000026A   E020               LDI     R18, 0
   \   0000026C   0712               CPC     R17, R18
   \   0000026E   F5E9               BRNE    ??USART0_RX_ISR_16
    277          				{
    278          					CRC.Word = 0;
   \   00000270   E000               LDI     R16, 0
   \   00000272   E010               LDI     R17, 0
   \   00000274   9300....           STS     CRC, R16
   \   00000278   9310....           STS     (CRC + 1), R17
    279          
    280          					RxBuf[2] = SEND;
   \   0000027C   E002               LDI     R16, 2
   \   0000027E   9300....           STS     (RxBuf + 2), R16
    281          					RxBuf[5] = (char)(DATA_Registers[RxAddr]>>8);
   \   00000282   9100....           LDS     R16, RxAddr
   \   00000286   9110....           LDS     R17, (RxAddr + 1)
   \   0000028A   0F00               LSL     R16
   \   0000028C   1F11               ROL     R17
   \   0000028E   01F8               MOVW    R31:R30, R17:R16
   \   00000290   ....               SUBI    R30, LOW((-(DATA_Registers) & 0xFFFF))
   \   00000292   ....               SBCI    R31, (-(DATA_Registers) & 0xFFFF) >> 8
   \   00000294   8111               LDD     R17, Z+1
   \   00000296   2F01               MOV     R16, R17
   \   00000298   9300....           STS     (RxBuf + 5), R16
    282          					RxBuf[6] = (char)DATA_Registers[RxAddr];
   \   0000029C   9100....           LDS     R16, RxAddr
   \   000002A0   9110....           LDS     R17, (RxAddr + 1)
   \   000002A4   0F00               LSL     R16
   \   000002A6   1F11               ROL     R17
   \   000002A8   01F8               MOVW    R31:R30, R17:R16
   \   000002AA   ....               SUBI    R30, LOW((-(DATA_Registers) & 0xFFFF))
   \   000002AC   ....               SBCI    R31, (-(DATA_Registers) & 0xFFFF) >> 8
   \   000002AE   8100               LD      R16, Z
   \   000002B0   9300....           STS     (RxBuf + 6), R16
    283          
    284          					CRC.Word = CRC16(RxBuf,7);
   \   000002B4   E027               LDI     R18, 7
   \   000002B6   E030               LDI     R19, 0
   \   000002B8   ....               LDI     R16, LOW(RxBuf)
   \   000002BA   ....               LDI     R17, (RxBuf) >> 8
   \   000002BC   ....               RCALL   CRC16
   \   000002BE   9300....           STS     CRC, R16
   \   000002C2   9310....           STS     (CRC + 1), R17
    285          
    286          					for(c=0;c<7;c++)	TX0_char(RxBuf[c]);
   \   000002C6   E080               LDI     R24, 0
   \   000002C8   C007               RJMP    ??USART0_RX_ISR_17
   \                     ??USART0_RX_ISR_18:
   \   000002CA   E090               LDI     R25, 0
   \   000002CC   01FC               MOVW    R31:R30, R25:R24
   \   000002CE   ....               SUBI    R30, LOW((-(RxBuf) & 0xFFFF))
   \   000002D0   ....               SBCI    R31, (-(RxBuf) & 0xFFFF) >> 8
   \   000002D2   8100               LD      R16, Z
   \   000002D4   ....               RCALL   TX0_char
   \   000002D6   9583               INC     R24
   \                     ??USART0_RX_ISR_17:
   \   000002D8   3087               CPI     R24, 7
   \   000002DA   F3B8               BRCS    ??USART0_RX_ISR_18
    287          					
    288          					TX0_char(CRC.Byte.b1);
   \   000002DC   9100....           LDS     R16, (CRC + 1)
   \   000002E0   ....               RCALL   TX0_char
    289          					TX0_char(CRC.Byte.b0);
   \   000002E2   9100....           LDS     R16, CRC
   \   000002E6   ....               RCALL   TX0_char
   \   000002E8   C012               RJMP    ??USART0_RX_ISR_12
    290          
    291          				}
    292          				else if(RxType == QUERY)
   \                     ??USART0_RX_ISR_16:
   \   000002EA   9100....           LDS     R16, RxType
   \   000002EE   9110....           LDS     R17, (RxType + 1)
   \   000002F2   3001               CPI     R16, 1
   \   000002F4   E020               LDI     R18, 0
   \   000002F6   0712               CPC     R17, R18
   \   000002F8   F451               BRNE    ??USART0_RX_ISR_12
    293          				{
    294          					Communication_Fault_Cnt = 3;
   \   000002FA   E003               LDI     R16, 3
   \   000002FC   E010               LDI     R17, 0
   \   000002FE   9300....           STS     Communication_Fault_Cnt, R16
   \   00000302   9310....           STS     (Communication_Fault_Cnt + 1), R17
    295          					device_type = RxData;
   \   00000306   9100....           LDS     R16, RxData
   \   0000030A   9300....           STS     device_type, R16
    296          				}
    297          				
    298          			}
    299          			SciC_RxStep=0;
   \                     ??USART0_RX_ISR_12:
   \   0000030E   E000               LDI     R16, 0
   \   00000310   9300....           STS     SciC_RxStep, R16
   \   00000314   C003               RJMP    ??USART0_RX_ISR_3
    300          		}
    301          	}
    302          	else SciC_RxStep=0;
   \                     ??USART0_RX_ISR_0:
   \   00000316   E000               LDI     R16, 0
   \   00000318   9300....           STS     SciC_RxStep, R16
    303          
    304          
    305          	return ;
   \                     ??USART0_RX_ISR_3:
   \   0000031C   BE4C               OUT     0x3C, R4
   \   0000031E   BFBB               OUT     0x3B, R27
   \   00000320   BFAF               OUT     0x3F, R26
   \   00000322   9109               LD      R16, Y+
   \   00000324   9119               LD      R17, Y+
   \   00000326   9129               LD      R18, Y+
   \   00000328   9139               LD      R19, Y+
   \   0000032A   9149               LD      R20, Y+
   \   0000032C   9159               LD      R21, Y+
   \   0000032E   9169               LD      R22, Y+
   \   00000330   9179               LD      R23, Y+
   \   00000332   9009               LD      R0, Y+
   \   00000334   9019               LD      R1, Y+
   \   00000336   9029               LD      R2, Y+
   \   00000338   9039               LD      R3, Y+
   \   0000033A   91E9               LD      R30, Y+
   \   0000033C   91F9               LD      R31, Y+
   \   0000033E   9189               LD      R24, Y+
   \   00000340   9199               LD      R25, Y+
   \   00000342   91A9               LD      R26, Y+
   \   00000344   91B9               LD      R27, Y+
   \   00000346   9049               LD      R4, Y+
   \   00000348   9518               RETI
   \   0000034A                      REQUIRE _A_UDR0
    306          }
    307          
    308          
    309          

   \                                 In  segment FARCODE, align 2, keep-with-next
    310          void TX0_char( char data)		/* transmit a character by USART0 */
   \                     TX0_char:
    311          {
   \   00000000                      REQUIRE __RSTACK_in_external_ram_new_way
    312          	while((UCSR0A & 0x20) == 0x00);		// data register empty ?
   \                     ??TX0_char_0:
   \   00000000   9110....           LDS     R17, _A_UCSR0A
   \   00000004   2F21               MOV     R18, R17
   \   00000006   FF25               SBRS    R18, 5
   \   00000008   CFFB               RJMP    ??TX0_char_0
    313          	UDR0 = data;
   \   0000000A   9300....           STS     _A_UDR0, R16
    314          }
   \   0000000E   9508               RET
   \   00000010                      REQUIRE _A_UDR0
   \   00000010                      REQUIRE _A_UCSR0A
    315          /*
    316          //===============================================================================================
    317          void CRC_16(unsigned char input)
    318          {
    319          	unsigned char 	i ;
    320          	unsigned int 	tmp_CRC ;
    321          
    322          	tmp_CRC=((CRC.Word >> 8) ^ input) << 8 ;
    323          	for (i = 0 ; i < 8 ; i++)
    324          	{
    325          		if (tmp_CRC & 0x8000) tmp_CRC = (tmp_CRC << 1) ^ GEN_POLYNOMAL ;
    326          		else tmp_CRC <<= 1 ;
    327          	}
    328          	CRC.Word = (CRC.Word << 8) ^ tmp_CRC ;
    329          }
    330          */
    331          
    332          
    333          //WORD SCI_Registers[Buf_MAX];

   \                                 In  segment NEAR_Z, align 1, keep-with-next
   \   00000000                      REQUIRE `?<Segment init: NEAR_Z>`
    334          WORD SCI_TxOffset=0;
   \                     SCI_TxOffset:
   \   00000000                      DS8 2

   \                                 In  segment NEAR_Z, align 1, keep-with-next
   \   00000000                      REQUIRE `?<Segment init: NEAR_Z>`
    335          WORD TxDelyCnt=0;
   \                     TxDelyCnt:
   \   00000000                      DS8 2

   \                                 In  segment NEAR_Z, align 1, keep-with-next
   \   00000000                      REQUIRE `?<Segment init: NEAR_Z>`
    336           unsigned char TxBuf[9];
   \                     TxBuf:
   \   00000000                      DS8 9

   \                                 In  segment FARCODE, align 2, keep-with-next
    337          void SCI_Process(void)
   \                     SCI_Process:
    338          {
   \   00000000   939A               ST      -Y, R25
   \   00000002   938A               ST      -Y, R24
   \   00000004                      REQUIRE __RSTACK_in_external_ram_new_way
    339          unsigned char 	c ;
    340          
    341          //Rx================================
    342          	 if(SciC_RxFlag)
   \   00000004   9100....           LDS     R16, SciC_RxFlag
   \   00000008   2300               TST     R16
   \   0000000A   F019               BREQ    ??SCI_Process_0
    343                	{
    344          		SciC_RxFlag = 0;
   \   0000000C   E000               LDI     R16, 0
   \   0000000E   9300....           STS     SciC_RxFlag, R16
    345                	}
    346          	 
    347          //Tx================================
    348          	if(!TxDelyCnt)
   \                     ??SCI_Process_0:
   \   00000012   9100....           LDS     R16, TxDelyCnt
   \   00000016   9110....           LDS     R17, (TxDelyCnt + 1)
   \   0000001A   2B01               OR      R16, R17
   \   0000001C   F009               BREQ    $+2+2
   \   0000001E   C0DA               RJMP    ??SCI_Process_1
    349          	{
    350          		if(DATA_Registers[SCI_TxOffset] != SCI_Registers[SCI_TxOffset])
   \   00000020   9100....           LDS     R16, SCI_TxOffset
   \   00000024   9110....           LDS     R17, (SCI_TxOffset + 1)
   \   00000028   0F00               LSL     R16
   \   0000002A   1F11               ROL     R17
   \   0000002C   01F8               MOVW    R31:R30, R17:R16
   \   0000002E   ....               SUBI    R30, LOW((-(DATA_Registers) & 0xFFFF))
   \   00000030   ....               SBCI    R31, (-(DATA_Registers) & 0xFFFF) >> 8
   \   00000032   8120               LD      R18, Z
   \   00000034   8131               LDD     R19, Z+1
   \   00000036   9100....           LDS     R16, SCI_TxOffset
   \   0000003A   9110....           LDS     R17, (SCI_TxOffset + 1)
   \   0000003E   0F00               LSL     R16
   \   00000040   1F11               ROL     R17
   \   00000042   01F8               MOVW    R31:R30, R17:R16
   \   00000044   ....               SUBI    R30, LOW((-(SCI_Registers) & 0xFFFF))
   \   00000046   ....               SBCI    R31, (-(SCI_Registers) & 0xFFFF) >> 8
   \   00000048   8100               LD      R16, Z
   \   0000004A   8111               LDD     R17, Z+1
   \   0000004C   1720               CP      R18, R16
   \   0000004E   0731               CPC     R19, R17
   \   00000050   F409               BRNE    $+2+2
   \   00000052   C051               RJMP    ??SCI_Process_2
    351          		{
    352          
    353          			CRC.Word = 0;
   \   00000054   E000               LDI     R16, 0
   \   00000056   E010               LDI     R17, 0
   \   00000058   9300....           STS     CRC, R16
   \   0000005C   9310....           STS     (CRC + 1), R17
    354          			TxBuf[0] = 0xAB;
   \   00000060   EA0B               LDI     R16, 171
   \   00000062   9300....           STS     TxBuf, R16
    355          			TxBuf[1] = 0xCD;
   \   00000066   EC0D               LDI     R16, 205
   \   00000068   9300....           STS     (TxBuf + 1), R16
    356          			TxBuf[2] = SEND;
   \   0000006C   E002               LDI     R16, 2
   \   0000006E   9300....           STS     (TxBuf + 2), R16
    357          			TxBuf[3] = ((char)(SCI_TxOffset>>8));	
   \   00000072   9110....           LDS     R17, (SCI_TxOffset + 1)
   \   00000076   2F01               MOV     R16, R17
   \   00000078   9300....           STS     (TxBuf + 3), R16
    358          			TxBuf[4]=  ((char)SCI_TxOffset);
   \   0000007C   9100....           LDS     R16, SCI_TxOffset
   \   00000080   9300....           STS     (TxBuf + 4), R16
    359          			TxBuf[5] = (char)(DATA_Registers[SCI_TxOffset]>>8);
   \   00000084   9100....           LDS     R16, SCI_TxOffset
   \   00000088   9110....           LDS     R17, (SCI_TxOffset + 1)
   \   0000008C   0F00               LSL     R16
   \   0000008E   1F11               ROL     R17
   \   00000090   01F8               MOVW    R31:R30, R17:R16
   \   00000092   ....               SUBI    R30, LOW((-(DATA_Registers) & 0xFFFF))
   \   00000094   ....               SBCI    R31, (-(DATA_Registers) & 0xFFFF) >> 8
   \   00000096   8111               LDD     R17, Z+1
   \   00000098   2F01               MOV     R16, R17
   \   0000009A   9300....           STS     (TxBuf + 5), R16
    360          			TxBuf[6] = (char)DATA_Registers[SCI_TxOffset];
   \   0000009E   9100....           LDS     R16, SCI_TxOffset
   \   000000A2   9110....           LDS     R17, (SCI_TxOffset + 1)
   \   000000A6   0F00               LSL     R16
   \   000000A8   1F11               ROL     R17
   \   000000AA   01F8               MOVW    R31:R30, R17:R16
   \   000000AC   ....               SUBI    R30, LOW((-(DATA_Registers) & 0xFFFF))
   \   000000AE   ....               SBCI    R31, (-(DATA_Registers) & 0xFFFF) >> 8
   \   000000B0   8100               LD      R16, Z
   \   000000B2   9300....           STS     (TxBuf + 6), R16
    361          
    362          			CRC.Word = CRC16(TxBuf,7);
   \   000000B6   E027               LDI     R18, 7
   \   000000B8   E030               LDI     R19, 0
   \   000000BA   ....               LDI     R16, LOW(TxBuf)
   \   000000BC   ....               LDI     R17, (TxBuf) >> 8
   \   000000BE   ....               RCALL   CRC16
   \   000000C0   9300....           STS     CRC, R16
   \   000000C4   9310....           STS     (CRC + 1), R17
    363          
    364          			for(c=0;c<7;c++)	TX0_char(TxBuf[c]);
   \   000000C8   E080               LDI     R24, 0
   \   000000CA   C007               RJMP    ??SCI_Process_3
   \                     ??SCI_Process_4:
   \   000000CC   E090               LDI     R25, 0
   \   000000CE   01FC               MOVW    R31:R30, R25:R24
   \   000000D0   ....               SUBI    R30, LOW((-(TxBuf) & 0xFFFF))
   \   000000D2   ....               SBCI    R31, (-(TxBuf) & 0xFFFF) >> 8
   \   000000D4   8100               LD      R16, Z
   \   000000D6   ....               RCALL   TX0_char
   \   000000D8   9583               INC     R24
   \                     ??SCI_Process_3:
   \   000000DA   3087               CPI     R24, 7
   \   000000DC   F3B8               BRCS    ??SCI_Process_4
    365          			
    366          			TX0_char(CRC.Byte.b1);
   \   000000DE   9100....           LDS     R16, (CRC + 1)
   \   000000E2   ....               RCALL   TX0_char
    367          			TX0_char(CRC.Byte.b0);
   \   000000E4   9100....           LDS     R16, CRC
   \   000000E8   ....               RCALL   TX0_char
    368          
    369          			
    370          			TxDelyCnt = 10;
   \   000000EA   E00A               LDI     R16, 10
   \   000000EC   E010               LDI     R17, 0
   \   000000EE   9300....           STS     TxDelyCnt, R16
   \   000000F2   9310....           STS     (TxDelyCnt + 1), R17
    371          		}
    372          
    373          		SCI_TxOffset ++;
   \                     ??SCI_Process_2:
   \   000000F6   ....               LDI     R30, LOW(SCI_TxOffset)
   \   000000F8   ....               LDI     R31, (SCI_TxOffset) >> 8
   \   000000FA   8100               LD      R16, Z
   \   000000FC   8111               LDD     R17, Z+1
   \   000000FE   5F0F               SUBI    R16, 255
   \   00000100   4F1F               SBCI    R17, 255
   \   00000102   8300               ST      Z, R16
   \   00000104   8311               STD     Z+1, R17
    374          		if(BUF_MAX <= SCI_TxOffset) 
   \   00000106   9100....           LDS     R16, SCI_TxOffset
   \   0000010A   9110....           LDS     R17, (SCI_TxOffset + 1)
   \   0000010E   3408               CPI     R16, 72
   \   00000110   E02D               LDI     R18, 13
   \   00000112   0712               CPC     R17, R18
   \   00000114   F030               BRCS    ??SCI_Process_5
    375          		{
    376          			SCI_TxOffset = 0;
   \   00000116   E000               LDI     R16, 0
   \   00000118   E010               LDI     R17, 0
   \   0000011A   9300....           STS     SCI_TxOffset, R16
   \   0000011E   9310....           STS     (SCI_TxOffset + 1), R17
    377          		}
    378          
    379          		if(TimeTic_1s)
   \                     ??SCI_Process_5:
   \   00000122   9100....           LDS     R16, TimeTic_1s
   \   00000126   2300               TST     R16
   \   00000128   F409               BRNE    $+2+2
   \   0000012A   C04A               RJMP    ??SCI_Process_6
    380          		{
    381          			CRC.Word = 0;
   \   0000012C   E000               LDI     R16, 0
   \   0000012E   E010               LDI     R17, 0
   \   00000130   9300....           STS     CRC, R16
   \   00000134   9310....           STS     (CRC + 1), R17
    382          			
    383          			TxBuf[0] = 0xAB;
   \   00000138   EA0B               LDI     R16, 171
   \   0000013A   9300....           STS     TxBuf, R16
    384          			TxBuf[1] = 0xCD;
   \   0000013E   EC0D               LDI     R16, 205
   \   00000140   9300....           STS     (TxBuf + 1), R16
    385          			TxBuf[2] = QUERY;
   \   00000144   E001               LDI     R16, 1
   \   00000146   9300....           STS     (TxBuf + 2), R16
    386          			TxBuf[3] = 0;	
   \   0000014A   E000               LDI     R16, 0
   \   0000014C   9300....           STS     (TxBuf + 3), R16
    387          			TxBuf[4]=  0;
   \   00000150   E000               LDI     R16, 0
   \   00000152   9300....           STS     (TxBuf + 4), R16
    388          			TxBuf[5] = 0;
   \   00000156   E000               LDI     R16, 0
   \   00000158   9300....           STS     (TxBuf + 5), R16
    389          			TxBuf[6] = 0;
   \   0000015C   E000               LDI     R16, 0
   \   0000015E   9300....           STS     (TxBuf + 6), R16
    390          
    391          			CRC.Word = CRC16(TxBuf,7);
   \   00000162   E027               LDI     R18, 7
   \   00000164   E030               LDI     R19, 0
   \   00000166   ....               LDI     R16, LOW(TxBuf)
   \   00000168   ....               LDI     R17, (TxBuf) >> 8
   \   0000016A   ....               RCALL   CRC16
   \   0000016C   9300....           STS     CRC, R16
   \   00000170   9310....           STS     (CRC + 1), R17
    392          
    393          			for(c=0;c<7;c++)	TX0_char(TxBuf[c]);
   \   00000174   E080               LDI     R24, 0
   \   00000176   C007               RJMP    ??SCI_Process_7
   \                     ??SCI_Process_8:
   \   00000178   E090               LDI     R25, 0
   \   0000017A   01FC               MOVW    R31:R30, R25:R24
   \   0000017C   ....               SUBI    R30, LOW((-(TxBuf) & 0xFFFF))
   \   0000017E   ....               SBCI    R31, (-(TxBuf) & 0xFFFF) >> 8
   \   00000180   8100               LD      R16, Z
   \   00000182   ....               RCALL   TX0_char
   \   00000184   9583               INC     R24
   \                     ??SCI_Process_7:
   \   00000186   3087               CPI     R24, 7
   \   00000188   F3B8               BRCS    ??SCI_Process_8
    394          			
    395          			TX0_char(CRC.Byte.b1);
   \   0000018A   9100....           LDS     R16, (CRC + 1)
   \   0000018E   ....               RCALL   TX0_char
    396          			TX0_char(CRC.Byte.b0);
   \   00000190   9100....           LDS     R16, CRC
   \   00000194   ....               RCALL   TX0_char
    397          
    398          			
    399          
    400          			if(!Communication_Fault_Cnt)Communication_Fault_Flag=1;
   \   00000196   9100....           LDS     R16, Communication_Fault_Cnt
   \   0000019A   9110....           LDS     R17, (Communication_Fault_Cnt + 1)
   \   0000019E   2B01               OR      R16, R17
   \   000001A0   F421               BRNE    ??SCI_Process_9
   \   000001A2   E001               LDI     R16, 1
   \   000001A4   9300....           STS     Communication_Fault_Flag, R16
   \   000001A8   C00B               RJMP    ??SCI_Process_6
    401          			else 
    402          			{
    403          				Communication_Fault_Cnt--;
   \                     ??SCI_Process_9:
   \   000001AA   ....               LDI     R30, LOW(Communication_Fault_Cnt)
   \   000001AC   ....               LDI     R31, (Communication_Fault_Cnt) >> 8
   \   000001AE   8100               LD      R16, Z
   \   000001B0   8111               LDD     R17, Z+1
   \   000001B2   5001               SUBI    R16, 1
   \   000001B4   4010               SBCI    R17, 0
   \   000001B6   8300               ST      Z, R16
   \   000001B8   8311               STD     Z+1, R17
    404          				Communication_Fault_Flag=0;
   \   000001BA   E000               LDI     R16, 0
   \   000001BC   9300....           STS     Communication_Fault_Flag, R16
    405          			}
    406          		}
    407          
    408          		if(TimeTic_500ms)
   \                     ??SCI_Process_6:
   \   000001C0   9100....           LDS     R16, TimeTic_500ms
   \   000001C4   2300               TST     R16
   \   000001C6   F071               BREQ    ??SCI_Process_10
    409          		{
    410          			SCI_RequestData(gRequestAddr);
   \   000001C8   9100....           LDS     R16, gRequestAddr
   \   000001CC   9110....           LDS     R17, (gRequestAddr + 1)
   \   000001D0   ....               RCALL   SCI_RequestData
   \   000001D2   C008               RJMP    ??SCI_Process_10
    411          		}
    412          	}
    413          	else
    414          	{
    415          		TxDelyCnt--;
   \                     ??SCI_Process_1:
   \   000001D4   ....               LDI     R30, LOW(TxDelyCnt)
   \   000001D6   ....               LDI     R31, (TxDelyCnt) >> 8
   \   000001D8   8100               LD      R16, Z
   \   000001DA   8111               LDD     R17, Z+1
   \   000001DC   5001               SUBI    R16, 1
   \   000001DE   4010               SBCI    R17, 0
   \   000001E0   8300               ST      Z, R16
   \   000001E2   8311               STD     Z+1, R17
    416          	}
    417          }
   \                     ??SCI_Process_10:
   \   000001E4   9189               LD      R24, Y+
   \   000001E6   9199               LD      R25, Y+
   \   000001E8   9508               RET
    418          
    419          

   \                                 In  segment FARCODE, align 2, keep-with-next
    420          void SCI_RequestData(unsigned int addr)
   \                     SCI_RequestData:
    421          {
   \   00000000   939A               ST      -Y, R25
   \   00000002   938A               ST      -Y, R24
   \   00000004                      REQUIRE __RSTACK_in_external_ram_new_way
    422          unsigned char 	c ;
    423          
    424          				CRC.Word = 0;
   \   00000004   E020               LDI     R18, 0
   \   00000006   E030               LDI     R19, 0
   \   00000008   9320....           STS     CRC, R18
   \   0000000C   9330....           STS     (CRC + 1), R19
    425          			
    426          			TxBuf[0] = 0xAB;
   \   00000010   EA2B               LDI     R18, 171
   \   00000012   9320....           STS     TxBuf, R18
    427          			TxBuf[1] = 0xCD;
   \   00000016   EC2D               LDI     R18, 205
   \   00000018   9320....           STS     (TxBuf + 1), R18
    428          			TxBuf[2] = REQUEST;
   \   0000001C   E024               LDI     R18, 4
   \   0000001E   9320....           STS     (TxBuf + 2), R18
    429          			TxBuf[3] = (char)(addr>>8);	
   \   00000022   0198               MOVW    R19:R18, R17:R16
   \   00000024   2F23               MOV     R18, R19
   \   00000026   9320....           STS     (TxBuf + 3), R18
    430          			TxBuf[4]=  (char)addr;
   \   0000002A   9300....           STS     (TxBuf + 4), R16
    431          
    432          			TxBuf[5] = 0;
   \   0000002E   E000               LDI     R16, 0
   \   00000030   9300....           STS     (TxBuf + 5), R16
    433          			TxBuf[6] = 0;
   \   00000034   E000               LDI     R16, 0
   \   00000036   9300....           STS     (TxBuf + 6), R16
    434          
    435          			CRC.Word = CRC16(TxBuf,7);
   \   0000003A   E027               LDI     R18, 7
   \   0000003C   E030               LDI     R19, 0
   \   0000003E   ....               LDI     R16, LOW(TxBuf)
   \   00000040   ....               LDI     R17, (TxBuf) >> 8
   \   00000042   ....               RCALL   CRC16
   \   00000044   9300....           STS     CRC, R16
   \   00000048   9310....           STS     (CRC + 1), R17
    436          
    437          			for(c=0;c<7;c++)	TX0_char(TxBuf[c]);
   \   0000004C   E080               LDI     R24, 0
   \   0000004E   C007               RJMP    ??SCI_RequestData_0
   \                     ??SCI_RequestData_1:
   \   00000050   E090               LDI     R25, 0
   \   00000052   01FC               MOVW    R31:R30, R25:R24
   \   00000054   ....               SUBI    R30, LOW((-(TxBuf) & 0xFFFF))
   \   00000056   ....               SBCI    R31, (-(TxBuf) & 0xFFFF) >> 8
   \   00000058   8100               LD      R16, Z
   \   0000005A   ....               RCALL   TX0_char
   \   0000005C   9583               INC     R24
   \                     ??SCI_RequestData_0:
   \   0000005E   3087               CPI     R24, 7
   \   00000060   F3B8               BRCS    ??SCI_RequestData_1
    438          			
    439          			TX0_char(CRC.Byte.b1);
   \   00000062   9100....           LDS     R16, (CRC + 1)
   \   00000066   ....               RCALL   TX0_char
    440          			TX0_char(CRC.Byte.b0);
   \   00000068   9100....           LDS     R16, CRC
   \   0000006C   ....               RCALL   TX0_char
    441          
    442          }
   \   0000006E   9189               LD      R24, Y+
   \   00000070   9199               LD      R25, Y+
   \   00000072   9508               RET
    443          

   \                                 In  segment FARCODE, align 2, keep-with-next
    444          void SCI_SendData(unsigned int addr, unsigned int data)
   \                     SCI_SendData:
    445          {
   \   00000000   ........           CALL    ?PROLOGUE6_L09
   \   00000004                      REQUIRE ?Register_R4_is_cg_reg
   \   00000004                      REQUIRE ?Register_R5_is_cg_reg
   \   00000004                      REQUIRE __RSTACK_in_external_ram_new_way
   \   00000004   01D8               MOVW    R27:R26, R17:R16
   \   00000006   0129               MOVW    R5:R4, R19:R18
    446          
    447          unsigned char 	c ;
    448          
    449          			CRC.Word = 0;
   \   00000008   E000               LDI     R16, 0
   \   0000000A   E010               LDI     R17, 0
   \   0000000C   9300....           STS     CRC, R16
   \   00000010   9310....           STS     (CRC + 1), R17
    450          			
    451          			TxBuf[0] = 0xAB;
   \   00000014   EA0B               LDI     R16, 171
   \   00000016   9300....           STS     TxBuf, R16
    452          			TxBuf[1] = 0xCD;
   \   0000001A   EC0D               LDI     R16, 205
   \   0000001C   9300....           STS     (TxBuf + 1), R16
    453          			TxBuf[2] = SEND;
   \   00000020   E002               LDI     R16, 2
   \   00000022   9300....           STS     (TxBuf + 2), R16
    454          			TxBuf[3] = (char)(addr>>8);	
   \   00000026   018D               MOVW    R17:R16, R27:R26
   \   00000028   2F01               MOV     R16, R17
   \   0000002A   9300....           STS     (TxBuf + 3), R16
    455          			TxBuf[4]=  (char)addr;
   \   0000002E   2F0A               MOV     R16, R26
   \   00000030   9300....           STS     (TxBuf + 4), R16
    456          			TxBuf[5] = (char)(data>>8);
   \   00000034   0182               MOVW    R17:R16, R5:R4
   \   00000036   2F01               MOV     R16, R17
   \   00000038   9300....           STS     (TxBuf + 5), R16
    457          			TxBuf[6] = (char)data;
   \   0000003C   2D04               MOV     R16, R4
   \   0000003E   9300....           STS     (TxBuf + 6), R16
    458          
    459          			CRC.Word = CRC16(TxBuf,7);
   \   00000042   E027               LDI     R18, 7
   \   00000044   E030               LDI     R19, 0
   \   00000046   ....               LDI     R16, LOW(TxBuf)
   \   00000048   ....               LDI     R17, (TxBuf) >> 8
   \   0000004A   ....               RCALL   CRC16
   \   0000004C   9300....           STS     CRC, R16
   \   00000050   9310....           STS     (CRC + 1), R17
    460          
    461          			for(c=0;c<7;c++)	TX0_char(TxBuf[c]);
   \   00000054   E080               LDI     R24, 0
   \   00000056   C007               RJMP    ??SCI_SendData_0
   \                     ??SCI_SendData_1:
   \   00000058   E090               LDI     R25, 0
   \   0000005A   01FC               MOVW    R31:R30, R25:R24
   \   0000005C   ....               SUBI    R30, LOW((-(TxBuf) & 0xFFFF))
   \   0000005E   ....               SBCI    R31, (-(TxBuf) & 0xFFFF) >> 8
   \   00000060   8100               LD      R16, Z
   \   00000062   ....               RCALL   TX0_char
   \   00000064   9583               INC     R24
   \                     ??SCI_SendData_0:
   \   00000066   3087               CPI     R24, 7
   \   00000068   F3B8               BRCS    ??SCI_SendData_1
    462          			
    463          			TX0_char(CRC.Byte.b1);
   \   0000006A   9100....           LDS     R16, (CRC + 1)
   \   0000006E   ....               RCALL   TX0_char
    464          			TX0_char(CRC.Byte.b0);
   \   00000070   9100....           LDS     R16, CRC
   \   00000074   ....               RCALL   TX0_char
    465          
    466          
    467          	DATA_Registers[addr] = data;
   \   00000076   0FAA               LSL     R26
   \   00000078   1FBB               ROL     R27
   \   0000007A   01FD               MOVW    R31:R30, R27:R26
   \   0000007C   ....               SUBI    R30, LOW((-(DATA_Registers) & 0xFFFF))
   \   0000007E   ....               SBCI    R31, (-(DATA_Registers) & 0xFFFF) >> 8
   \   00000080   8240               ST      Z, R4
   \   00000082   8251               STD     Z+1, R5
    468          
    469          
    470          }
   \   00000084   E0E6               LDI     R30, 6
   \   00000086   ........           JMP     ?EPILOGUE_B6_L09
    471          

   \                                 In  segment FARCODE, align 2, keep-with-next
    472          void SCI_RegisterRefresh(void)
   \                     SCI_RegisterRefresh:
    473          {
   \   00000000   939A               ST      -Y, R25
   \   00000002   938A               ST      -Y, R24
   \   00000004                      REQUIRE __RSTACK_in_external_ram_new_way
    474          	int i;
    475          	unsigned char 	c ;
    476          	for(i=0;i<BUF_MAX;i++)
   \   00000004   E080               LDI     R24, 0
   \   00000006   E090               LDI     R25, 0
   \   00000008   C015               RJMP    ??SCI_RegisterRefresh_0
    477          	{
    478          		DATA_Registers[i]=0;
   \                     ??SCI_RegisterRefresh_1:
   \   0000000A   E000               LDI     R16, 0
   \   0000000C   E010               LDI     R17, 0
   \   0000000E   019C               MOVW    R19:R18, R25:R24
   \   00000010   0F22               LSL     R18
   \   00000012   1F33               ROL     R19
   \   00000014   01F9               MOVW    R31:R30, R19:R18
   \   00000016   ....               SUBI    R30, LOW((-(DATA_Registers) & 0xFFFF))
   \   00000018   ....               SBCI    R31, (-(DATA_Registers) & 0xFFFF) >> 8
   \   0000001A   8300               ST      Z, R16
   \   0000001C   8311               STD     Z+1, R17
    479          		SCI_Registers[i]=0;
   \   0000001E   E000               LDI     R16, 0
   \   00000020   E010               LDI     R17, 0
   \   00000022   019C               MOVW    R19:R18, R25:R24
   \   00000024   0F22               LSL     R18
   \   00000026   1F33               ROL     R19
   \   00000028   01F9               MOVW    R31:R30, R19:R18
   \   0000002A   ....               SUBI    R30, LOW((-(SCI_Registers) & 0xFFFF))
   \   0000002C   ....               SBCI    R31, (-(SCI_Registers) & 0xFFFF) >> 8
   \   0000002E   8300               ST      Z, R16
   \   00000030   8311               STD     Z+1, R17
    480          	}
   \   00000032   9601               ADIW    R25:R24, 1
   \                     ??SCI_RegisterRefresh_0:
   \   00000034   3488               CPI     R24, 72
   \   00000036   E00D               LDI     R16, 13
   \   00000038   0790               CPC     R25, R16
   \   0000003A   F33C               BRLT    ??SCI_RegisterRefresh_1
    481          
    482          		CRC.Word = 0;
   \   0000003C   E000               LDI     R16, 0
   \   0000003E   E010               LDI     R17, 0
   \   00000040   9300....           STS     CRC, R16
   \   00000044   9310....           STS     (CRC + 1), R17
    483          			
    484          			TxBuf[0] = 0xAB;
   \   00000048   EA0B               LDI     R16, 171
   \   0000004A   9300....           STS     TxBuf, R16
    485          			TxBuf[1] = 0xCD;
   \   0000004E   EC0D               LDI     R16, 205
   \   00000050   9300....           STS     (TxBuf + 1), R16
    486          			TxBuf[2] = SEND;
   \   00000054   E002               LDI     R16, 2
   \   00000056   9300....           STS     (TxBuf + 2), R16
    487          			TxBuf[3] = 0x0C;	
   \   0000005A   E00C               LDI     R16, 12
   \   0000005C   9300....           STS     (TxBuf + 3), R16
    488          			TxBuf[4]=  0x7B;
   \   00000060   E70B               LDI     R16, 123
   \   00000062   9300....           STS     (TxBuf + 4), R16
    489          			TxBuf[5] = 0;
   \   00000066   E000               LDI     R16, 0
   \   00000068   9300....           STS     (TxBuf + 5), R16
    490          			TxBuf[6] = 1;
   \   0000006C   E001               LDI     R16, 1
   \   0000006E   9300....           STS     (TxBuf + 6), R16
    491          
    492          			CRC.Word = CRC16(TxBuf,7);
   \   00000072   E027               LDI     R18, 7
   \   00000074   E030               LDI     R19, 0
   \   00000076   ....               LDI     R16, LOW(TxBuf)
   \   00000078   ....               LDI     R17, (TxBuf) >> 8
   \   0000007A   ....               RCALL   CRC16
   \   0000007C   9300....           STS     CRC, R16
   \   00000080   9310....           STS     (CRC + 1), R17
    493          
    494          			for(c=0;c<7;c++)	TX0_char(TxBuf[c]);
   \   00000084   E080               LDI     R24, 0
   \   00000086   C007               RJMP    ??SCI_RegisterRefresh_2
   \                     ??SCI_RegisterRefresh_3:
   \   00000088   E090               LDI     R25, 0
   \   0000008A   01FC               MOVW    R31:R30, R25:R24
   \   0000008C   ....               SUBI    R30, LOW((-(TxBuf) & 0xFFFF))
   \   0000008E   ....               SBCI    R31, (-(TxBuf) & 0xFFFF) >> 8
   \   00000090   8100               LD      R16, Z
   \   00000092   ....               RCALL   TX0_char
   \   00000094   9583               INC     R24
   \                     ??SCI_RegisterRefresh_2:
   \   00000096   3087               CPI     R24, 7
   \   00000098   F3B8               BRCS    ??SCI_RegisterRefresh_3
    495          			
    496          			TX0_char(CRC.Byte.b1);
   \   0000009A   9100....           LDS     R16, (CRC + 1)
   \   0000009E   ....               RCALL   TX0_char
    497          			TX0_char(CRC.Byte.b0);
   \   000000A0   9100....           LDS     R16, CRC
   \   000000A4   ....               RCALL   TX0_char
    498          
    499          	DATA_Registers[0x0C7B]=1;
   \   000000A6   E001               LDI     R16, 1
   \   000000A8   E010               LDI     R17, 0
   \   000000AA   9300....           STS     (DATA_Registers + 6390), R16
   \   000000AE   9310....           STS     (DATA_Registers + 6391), R17
    500          	SCI_Registers[0x0C7B]=0;
   \   000000B2   E000               LDI     R16, 0
   \   000000B4   E010               LDI     R17, 0
   \   000000B6   9300....           STS     (SCI_Registers + 6390), R16
   \   000000BA   9310....           STS     (SCI_Registers + 6391), R17
    501          
    502          }
   \   000000BE   9189               LD      R24, Y+
   \   000000C0   9199               LD      R25, Y+
   \   000000C2   9508               RET
    503          
    504          
    505          #pragma vector = USART0_TX_vect

   \                                 In  segment FARCODE, align 2, keep-with-next
    506          __interrupt void USART0_TX_ISR(void)
   \                     USART0_TX_ISR:
    507          //ISR(USART0_TX_vect)             // USART2 Tx Complete interrupt
    508          {
   \   00000000   933A               ST      -Y, R19
   \   00000002   932A               ST      -Y, R18
   \   00000004   931A               ST      -Y, R17
   \   00000006   930A               ST      -Y, R16
   \   00000008   B71F               IN      R17, 0x3F
   \   0000000A   B72B               IN      R18, 0x3B
   \   0000000C   B73C               IN      R19, 0x3C
   \   0000000E                      REQUIRE __RSTACK_in_external_ram_new_way
    509          	UCSR0B = UCSR0B | 0x10;
   \   0000000E   910000C1           LDS     R16, 193
   \   00000012   6100               ORI     R16, 0x10
   \   00000014   930000C1           STS     193, R16
    510          }
   \   00000018   BF3C               OUT     0x3C, R19
   \   0000001A   BF2B               OUT     0x3B, R18
   \   0000001C   BF1F               OUT     0x3F, R17
   \   0000001E   9109               LD      R16, Y+
   \   00000020   9119               LD      R17, Y+
   \   00000022   9129               LD      R18, Y+
   \   00000024   9139               LD      R19, Y+
   \   00000026   9518               RETI
   \   00000028                      REQUIRE _A_UCSR0B

   \                                 In  segment INTVEC, offset 0x64, root
   \                     `??USART0_RX_ISR??INTVEC 100`:
   \   00000064   ........           JMP     USART0_RX_ISR

   \                                 In  segment INTVEC, offset 0x6c, root
   \                     `??USART0_TX_ISR??INTVEC 108`:
   \   0000006C   ........           JMP     USART0_TX_ISR

   \                                 In  segment NEAR_ID, align 1, keep-with-next
   \                     `?<Initializer for Communication_Fault_Cnt>`:
   \   00000000   0003               DC16 3

   \                                 In  segment NEAR_ID, align 1, keep-with-next
   \                     `?<Initializer for aucCRCHi>`:
   \   00000000   C1004081C001       DC8 0, 193, 129, 64, 1, 192, 128, 65, 1, 192, 128, 65, 0, 193, 129, 64
   \              4180C0014180
   \              C1004081    
   \   00000010   C0014180C100       DC8 1, 192, 128, 65, 0, 193, 129, 64, 0, 193, 129, 64, 1, 192, 128, 65
   \              4081C1004081
   \              C0014180    
   \   00000020   C0014180C100       DC8 1, 192, 128, 65, 0, 193, 129, 64, 0, 193, 129, 64, 1, 192, 128, 65
   \              4081C1004081
   \              C0014180    
   \   00000030   C1004081C001       DC8 0, 193, 129, 64, 1, 192, 128, 65, 1, 192, 128, 65, 0, 193, 129, 64
   \              4180C0014180
   \              C1004081    
   \   00000040   C0014180C100       DC8 1, 192, 128, 65, 0, 193, 129, 64, 0, 193, 129, 64, 1, 192, 128, 65
   \              4081C1004081
   \              C0014180    
   \   00000050   C1004081C001       DC8 0, 193, 129, 64, 1, 192, 128, 65, 1, 192, 128, 65, 0, 193, 129, 64
   \              4180C0014180
   \              C1004081    
   \   00000060   C1004081C001       DC8 0, 193, 129, 64, 1, 192, 128, 65, 1, 192, 128, 65, 0, 193, 129, 64
   \              4180C0014180
   \              C1004081    
   \   00000070   C0014180C100       DC8 1, 192, 128, 65, 0, 193, 129, 64, 0, 193, 129, 64, 1, 192, 128, 65
   \              4081C1004081
   \              C0014180    
   \   00000080   C0014180C100       DC8 1, 192, 128, 65, 0, 193, 129, 64, 0, 193, 129, 64, 1, 192, 128, 65
   \              4081C1004081
   \              C0014180    
   \   00000090   C1004081C001       DC8 0, 193, 129, 64, 1, 192, 128, 65, 1, 192, 128, 65, 0, 193, 129, 64
   \              4180C0014180
   \              C1004081    
   \   000000A0   C1004081C001       DC8 0, 193, 129, 64, 1, 192, 128, 65, 1, 192, 128, 65, 0, 193, 129, 64
   \              4180C0014180
   \              C1004081    
   \   000000B0   C0014180C100       DC8 1, 192, 128, 65, 0, 193, 129, 64, 0, 193, 129, 64, 1, 192, 128, 65
   \              4081C1004081
   \              C0014180    
   \   000000C0   C1004081C001       DC8 0, 193, 129, 64, 1, 192, 128, 65, 1, 192, 128, 65, 0, 193, 129, 64
   \              4180C0014180
   \              C1004081    
   \   000000D0   C0014180C100       DC8 1, 192, 128, 65, 0, 193, 129, 64, 0, 193, 129, 64, 1, 192, 128, 65
   \              4081C1004081
   \              C0014180    
   \   000000E0   C0014180C100       DC8 1, 192, 128, 65, 0, 193, 129, 64, 0, 193, 129, 64, 1, 192, 128, 65
   \              4081C1004081
   \              C0014180    
   \   000000F0   C1004081C001       DC8 0, 193, 129, 64, 1, 192, 128, 65, 1, 192, 128, 65, 0, 193, 129, 64
   \              4180C0014180
   \              C1004081    

   \                                 In  segment NEAR_ID, align 1, keep-with-next
   \                     `?<Initializer for aucCRCLo>`:
   \   00000000   C00001C103C3       DC8 0, 192, 193, 1, 195, 3, 2, 194, 198, 6, 7, 199, 5, 197, 196, 4, 204
   \              C20206C6C707
   \              C50504C4CC  
   \   00000011   0D0C0FCDCECF       DC8 12, 13, 205, 15, 207, 206, 14, 10, 202, 203, 11, 201, 9, 8, 200
   \              0A0ECBCAC90B
   \              0809C8      
   \   00000020   18D8D919DB1B       DC8 216, 24, 25, 217, 27, 219, 218, 26, 30, 222, 223, 31, 221, 29, 28
   \              1ADADE1E1FDF
   \              1DDD1C      
   \   0000002F   14DCD5D4D715       DC8 220, 20, 212, 213, 21, 215, 23, 22, 214, 210, 18, 19, 211, 17, 209
   \              1617D2D61312
   \              11D3D1      
   \   0000003E   10D030F0F131       DC8 208, 16, 240, 48, 49, 241, 51, 243, 242, 50, 54, 246, 247, 55, 245
   \              F33332F2F636
   \              37F7F5      
   \   0000004D   34353CF4FDFC       DC8 53, 52, 244, 60, 252, 253, 61, 255, 63, 62, 254, 250, 58, 59, 251
   \              FF3D3E3FFAFE
   \              3B3AFB      
   \   0000005C   F93938F8E828       DC8 57, 249, 248, 56, 40, 232, 233, 41, 235, 43, 42, 234, 238, 46, 47
   \              29E92BEBEA2A
   \              2EEE2F      
   \   0000006B   2DEFECEDE42C       DC8 239, 45, 237, 236, 44, 228, 36, 37, 229, 39, 231, 230, 38, 34, 226
   \              252427E5E6E7
   \              2226E2      
   \   0000007A   23E321E1E020       DC8 227, 35, 225, 33, 32, 224, 160, 96, 97, 161, 99, 163, 162, 98, 102
   \              60A0A161A363
   \              62A266      
   \   00000089   A7A6A5676465       DC8 166, 167, 103, 165, 101, 100, 164, 108, 172, 173, 109, 175, 111
   \              6CA4ADACAF6D
   \              6F          
   \   00000096   AE6E6AAAAB6B       DC8 110, 174, 170, 106, 107, 171, 105, 169, 168, 104, 120, 184, 185
   \              A96968A8B878
   \              B9          
   \   000000A3   BB797A7BBEBA       DC8 121, 187, 123, 122, 186, 190, 126, 127, 191, 125, 189, 188, 124
   \              7F7E7DBFBCBD
   \              7C          
   \   000000B0   74B4B575B777       DC8 180, 116, 117, 181, 119, 183, 182, 118, 114, 178, 179, 115, 177
   \              76B6B27273B3
   \              B1          
   \   000000BD   707150B09190       DC8 113, 112, 176, 80, 144, 145, 81, 147, 83, 82, 146, 150, 86, 87, 151
   \              935152539692
   \              575697      
   \   000000CC   955554945C9C       DC8 85, 149, 148, 84, 156, 92, 93, 157, 95, 159, 158, 94, 90, 154, 155
   \              9D5D9F5F5E9E
   \              9A5A9B      
   \   000000DB   995B58598898       DC8 91, 153, 89, 88, 152, 136, 72, 73, 137, 75, 139, 138, 74, 78, 142
   \              49484B898A8B
   \              4E4A8E      
   \   000000EA   4F8F4D8D8C4C       DC8 143, 79, 141, 77, 76, 140, 68, 132, 133, 69, 135, 71, 70, 134, 130
   \              844445854787
   \              864682      
   \   000000F9   434241838081       DC8 66, 67, 131, 65, 129, 128, 64
   \              40          
    511          
    512          
    513          
    514          
    515          

   Maximum stack usage in bytes:

     Function             CSTACK RSTACK
     --------             ------ ------
     CRC16                    0      3
     ReadDataMem              0      3
     SCI_Process              2      3
       -> CRC16               2      3
       -> TX0_char            2      3
       -> TX0_char            2      3
       -> TX0_char            2      3
       -> CRC16               2      3
       -> TX0_char            2      3
       -> TX0_char            2      3
       -> TX0_char            2      3
       -> SCI_RequestData     2      3
     SCI_RegisterRefresh      2      3
       -> CRC16               2      3
       -> TX0_char            2      3
       -> TX0_char            2      3
       -> TX0_char            2      3
     SCI_RequestData          2      3
       -> CRC16               2      3
       -> TX0_char            2      3
       -> TX0_char            2      3
       -> TX0_char            2      3
     SCI_SendData             6      3
       -> CRC16               6      3
       -> TX0_char            6      3
       -> TX0_char            6      3
       -> TX0_char            6      3
     TX0_char                 0      3
     UART_init                0      3
     USART0_RX_ISR           19      3
       -> CRC16              19      3
       -> CRC16              19      3
       -> TX0_char           19      3
       -> TX0_char           19      3
       -> TX0_char           19      3
       -> CRC16              19      3
       -> TX0_char           19      3
       -> TX0_char           19      3
       -> TX0_char           19      3
     USART0_TX_ISR            4      3
     WriteDataMem             0      3


   Segment part sizes:

     Function/Label                             Bytes
     --------------                             -----
     _A_UDR0                                       1
     _A_UBRR0                                      2
     _A_UCSR0C                                     1
     _A_UCSR0B                                     1
     _A_UCSR0A                                     1
     CRC                                           2
     data_flg                                      2
     Communication_Fault_Cnt                       2
     Communication_Fault_Flag                      1
     SCI_Registers                              6800
     packet                                        8
     aucCRCHi                                    256
     aucCRCLo                                    256
     CRC16                                        76
     UART_init                                    44
     WriteDataMem                                 16
     ReadDataMem                                  24
     SciC_RxStep                                   1
     SciC_RxFlag                                   1
     RxType                                        2
     RxAddr                                        2
     RxData                                        2
     RxCRC                                         2
     RxBuf                                         9
     RXD0                                          1
     USART0_RX_ISR                               842
     TX0_char                                     16
     SCI_TxOffset                                  2
     TxDelyCnt                                     2
     TxBuf                                         9
     SCI_Process                                 490
     SCI_RequestData                             116
     SCI_SendData                                138
     SCI_RegisterRefresh                         196
     USART0_TX_ISR                                40
     ??USART0_RX_ISR??INTVEC 100                   4
     ??USART0_TX_ISR??INTVEC 108                   4
     ?<Initializer for Communication_Fault_Cnt>    2
     ?<Initializer for aucCRCHi>                 256
     ?<Initializer for aucCRCLo>                 256
      Others                                      14

 
     6 bytes in segment ABSOLUTE
 1 998 bytes in segment FARCODE
    14 bytes in segment INITTAB
     8 bytes in segment INTVEC
   514 bytes in segment NEAR_I
   514 bytes in segment NEAR_ID
 6 846 bytes in segment NEAR_Z
 
 2 512 bytes of CODE memory (+ 22 bytes shared)
 7 360 bytes of DATA memory (+  6 bytes shared)

Errors: none
Warnings: none
